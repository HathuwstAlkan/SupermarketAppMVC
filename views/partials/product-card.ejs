<div class="product-card card">
  <div class="card-img-top position-relative">
    <img src="/images/<%= product.image ? 'products/' + product.image : 'misc/no-image.svg' %>" class="img-fluid" alt="<%= product.productName %>" style="height:160px;object-fit:cover;">
    <% if (product.featured || product.deal) { %>
      <span class="promo-badge position-absolute top-0 start-0 m-2"><%= product.deal ? 'Deal' : 'Featured' %></span>
    <% } %>
    <div class="product-actions position-absolute top-0 end-0 m-2 d-flex gap-1">
      <a href="#" class="btn btn-sm btn-light open-product" data-id="<%= product.id %>" title="View"><i class="fa fa-eye"></i></a>
      <% if (typeof user !== 'undefined' && user) { %>
        <form action="/add-to-cart/<%= product.id %>" method="POST" class="d-inline add-to-cart-form">
          <input type="hidden" id="hidden-qty-<%= product.id %>" name="quantity" value="1">
          <button class="btn btn-sm btn-primary btn-add" title="Add to cart" <%= (product.available || 0) <= 0 ? 'disabled' : '' %>><i class="fa fa-shopping-cart"></i></button>
        </form>
      <% } else { %>
        <a href="#" class="btn btn-sm btn-outline-primary open-login" title="Sign in to add">Sign in</a>
      <% } %>
    </div>
    <div class="hover-overlay small d-flex justify-content-between align-items-center px-2">
      <div>$<%= Number(product.price || 0).toFixed(2) %></div>
      <% if (product.deal) { %>
        <div class="badge bg-warning text-dark">Deal</div>
      <% } else if (product.featured) { %>
        <div class="badge bg-light text-dark">Featured</div>
      <% } %>
    </div>
  </div>
  <div class="card-body p-2">
    <h6 class="card-title mb-1"><%= product.productName %></h6>
    <div class="small text-muted mb-1">
      <% if (product.brand) { %>
        <span class="me-2">Brand: <strong><%= product.brand %></strong></span>
      <% } %>
      <% if (product.category) { %>
        <span>Category: <%= product.category %></span>
      <% } %>
    </div>
    <div class="d-flex justify-content-between align-items-center">
      <small class="text-muted">$<%= Number(product.price || 0).toFixed(2) %></small>
      <small class="text-muted">Avail: <%= product.available || 0 %></small>
    </div>
    <% if (product.daysRemaining || product.bestBefore) { %>
      <div class="mt-2">
        <% if (product.daysRemaining) { %>
          <small class="text-warning days-remaining">Expires in <%= product.daysRemaining %>d</small>
        <% } else if (product.bestBefore) { %>
          <% const dd = new Date(product.bestBefore); const now = new Date(); const diff = Math.ceil((dd - now) / (1000*60*60*24)); %>
          <small class="text-warning days-remaining">Expires in <%= diff %>d</small>
        <% } %>
      </div>
    <% } %>
  </div>
</div>
