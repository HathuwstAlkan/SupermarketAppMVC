<!-- product.ejs -->

<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('partials/head') %>
  <title>Product - Supermarket App</title>
</head>
<body class="d-flex flex-column min-vh-100">
  <%- include('partials/navbar') %>

    <div class="container app-main">
        <% if (user) { %>
          <p class="text-muted small">Welcome, <%= user.username %> (<%= user.role %>)</p>
        <% } else { %>
          <p class="text-muted small">You are browsing as a guest. Sign in to add items to your cart.</p>
        <% } %>
        <div class="text-center"><h2>Product Details</h2></div>
        <div class="row gy-3 mt-3">
          <% if (product) { %>
            <div class="col-12 col-md-5">
              <img src="/images/<%= product.image ? 'products/' + product.image : 'misc/no-image.svg' %>" class="img-fluid rounded" alt="<%= product.productName %>">
            </div>
            <div class="col-12 col-md-7">
              <h3><%= product.productName %></h3>
              <p class="mb-1 text-muted">Category: <%= product.category || 'General' %> — Brand: <%= product.brand || '—' %></p>
              <p class="lead">$<%= Number(product.price || 0).toFixed(2) %></p>
              <p class="mb-2">Available: <strong><%= product.available || product.quantity || 0 %></strong></p>

              <% if (user) { %>
              <form action="/add-to-cart/<%= product.id %>" method="POST" class="d-flex align-items-center gap-2 add-to-cart-form" style="max-width:360px;">
                <div class="input-group input-group-sm" style="width:160px;">
                  <button type="button" class="btn btn-outline-secondary btn-decrement" data-target="qty-<%= product.id %>">-</button>
                  <input id="qty-<%= product.id %>" class="form-control qty-input" type="number" min="1" value="1" data-max="<%= product.available || product.quantity || 0 %>">
                  <button type="button" class="btn btn-outline-secondary btn-increment" data-target="qty-<%= product.id %>">+</button>
                </div>
                <input type="hidden" id="hidden-qty-<%= product.id %>" name="quantity" value="1">
                <button type="submit" class="btn btn-primary btn-add">Add to cart</button>
              </form>
              <% } else { %>
                <a href="#" class="btn btn-primary open-login">Sign in to buy</a>
              <% } %>

              <div class="mt-3">
                <a class="btn btn-link" href="/shopping">Back to shop</a>
              </div>
            </div>
          <% } else { %>
            <div class="col-12">No product found.</div>
          <% } %>
        </div>
    </div>
    <script src="/js/ui.js"></script>
    
</body>
</html>
