<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('partials/head') %>
  <title>Update Product - Supermarket MVC</title>
</head>
<body>
  <%- include('partials/navbar') %>

  <!-- Main content -->
  <div class="container mt-4">
    <h2 class="text-center mb-4">Update Product</h2>
    
    <% if (product) { %>
      <form action="/updateProduct/<%= product.id %>" method="POST" enctype="multipart/form-data" class="mx-auto" style="max-width: 500px;">
        
        <div class="mb-3">
          <label for="name" class="form-label">Product Name</label>
          <input type="text" class="form-control" id="name" name="name" value="<%= product.productName %>" required>
        </div>

        <div class="mb-3">
          <label for="quantity" class="form-label">Quantity</label>
          <input type="number" class="form-control" id="quantity" name="quantity" min="0" step="1" value="<%= product.quantity %>" required>
        </div>

        <div class="mb-3">
          <label for="price" class="form-label">Price</label>
          <input type="number" class="form-control" id="price" name="price" min="0" step="0.01" value="<%= product.price %>" required>
        </div>

        <div class="mb-3">
          <label for="category" class="form-label">Category</label>
          <select class="form-select" id="category" name="category">
            <option value="Other" <%= (product.category === 'Other' || !product.category) ? 'selected' : '' %>>Uncategorized</option>
            <option value="Fruits & Vegetables" <%= product.category === 'Fruits & Vegetables' ? 'selected' : '' %>>Fruits & Vegetables</option>
            <option value="Dairy & Eggs" <%= product.category === 'Dairy & Eggs' ? 'selected' : '' %>>Dairy & Eggs</option>
            <option value="Meat & Seafood" <%= product.category === 'Meat & Seafood' ? 'selected' : '' %>>Meat & Seafood</option>
            <option value="Bakery" <%= product.category === 'Bakery' ? 'selected' : '' %>>Bakery</option>
            <option value="Beverages" <%= product.category === 'Beverages' ? 'selected' : '' %>>Beverages</option>
            <option value="Snacks & Candy" <%= product.category === 'Snacks & Candy' ? 'selected' : '' %>>Snacks & Candy</option>
            <option value="Canned & Packaged Foods" <%= product.category === 'Canned & Packaged Foods' ? 'selected' : '' %>>Canned & Packaged Foods</option>
            <option value="Frozen Foods" <%= product.category === 'Frozen Foods' ? 'selected' : '' %>>Frozen Foods</option>
            <option value="Personal Care" <%= product.category === 'Personal Care' ? 'selected' : '' %>>Personal Care</option>
            <option value="Household" <%= product.category === 'Household' ? 'selected' : '' %>>Household</option>
          </select>
          <small class="text-muted">Select the appropriate category for filtering and display</small>
        </div>

        <div class="mb-3">
          <label for="description" class="form-label">Description</label>
          <textarea class="form-control" id="description" name="description" rows="3" placeholder="Enter product description (optional)"><%= product.description || '' %></textarea>
        </div>

        <div class="mb-3">
          <label for="brand" class="form-label">Brand</label>
          <input type="text" class="form-control" id="brand" name="brand" value="<%= product.brand || '' %>" placeholder="e.g., GoldenBake, DairyPure">
        </div>

        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" value="1" id="featured" name="featured" <%= product.featured ? 'checked' : '' %>>
          <label class="form-check-label" for="featured">Featured</label>
        </div>

        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" value="1" id="deal" name="deal" <%= product.deal ? 'checked' : '' %>>
          <label class="form-check-label" for="deal">Deal (promotion)</label>
        </div>

        <div class="mb-3">
          <label for="bestBefore" class="form-label">Best Before</label>
          <input type="date" class="form-control" id="bestBefore" name="bestBefore" value="<%= product.bestBefore ? (new Date(product.bestBefore)).toISOString().slice(0,10) : '' %>">
        </div>

        <div class="form-check mb-3">
          <input class="form-check-input" type="checkbox" value="1" id="perishable" name="perishable" <%= product.perishable ? 'checked' : '' %>>
          <label class="form-check-label" for="perishable">Perishable (affects delivery time estimates)</label>
        </div>

        <div class="mb-3">
          <label class="form-label">Current Image</label>
          <div>
            <img src="/images/<%= product.image ? product.image : 'misc/no-image.svg' %>" 
                 class="img-thumbnail" 
                 style="max-width: 200px; max-height: 200px;"
                 onerror="this.src='/images/misc/no-image.svg'">
          </div>
          <input type="hidden" name="currentImage" value="<%= product.image %>">
        </div>

        <div class="mb-4">
          <label for="image" class="form-label">Upload New Image (optional)</label>
          <input class="form-control" type="file" id="image" name="image" accept="image/*" onchange="previewUpdateImage(event)">
          <div class="mt-2">
            <img id="imagePreview" src="" alt="Preview" style="max-width:200px;max-height:200px;display:none;" class="img-thumbnail">
          </div>
        </div>

        <script>
          function previewUpdateImage(event) {
            const preview = document.getElementById('imagePreview');
            const file = event.target.files[0];
            if (file) {
              const reader = new FileReader();
              reader.onload = function(e) {
                preview.src = e.target.result;
                preview.style.display = 'block';
              };
              reader.readAsDataURL(file);
            } else {
              preview.style.display = 'none';
            }
          }
        </script>

        <div class="d-grid gap-2">
          <button type="submit" class="btn btn-primary">Update Product</button>
          <a href="/inventory" class="btn btn-secondary">Back to Inventory</a>
        </div>
      </form>
    <% } else { %>
      <p class="text-center">No product found.</p>
    <% } %>
  </div>
</body>
</html>
